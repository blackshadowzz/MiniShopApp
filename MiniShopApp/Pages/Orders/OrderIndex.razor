
@page "/orders"  
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@layout MainLayout2  
@rendermode InteractiveServer  

<PageTitle>Products</PageTitle>  
<div>  
    @* <p>Id: @customerId</p> *@
    <div class="my-2">  
        <div class="input-group mb-3">  
            <input type="text"  
                   class="form-control"  
                   value="@_filter"  
                   @oninput="@((e) => OnSearch(e))"  
                   placeholder="Search here..."  
                   aria-label="Search here..."  
                   aria-describedby="button-addon2"
                   />  
            <button class="btn btn-outline-secondary" @onclick="OnGetSearchRefresh" type="button" id="button-addon2"><i class="bi bi-search"></i></button>  
        </div>  
    </div>  
    <div class="row row-cols-3 row-cols-md-6 g-2">  
        @foreach (var list in _products)  
        {  
            <div class="col">  

                <div class="card h-100">
                    @if(list?.QTYIncrease > 0)  
                    {  
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">  
                            @list?.QTYIncrease  
                            <span class="visually-hidden">unread messages</span>  
                        </span>
                    }
    
                    
                    <img src="..." class="card-img-top" alt="...">  
                    <div class="card-body">  
                        <h6 class="card-title">@list?.ProductName</h6>
                        <h5 class="card-text text-danger">@String.Format("${0:N2}", list?.Price)</h5>
                    </div>  
                    <div class="d-flex justify-content-between mx-2 my-2">
                        <RadzenButton class="btn btn-sm btn-primary" Size=ButtonSize.ExtraSmall Visible=true Click="@(() => DescreasProduct(list!.Id))" Icon="remove"></RadzenButton>

                        <RadzenButton class="btn btn-sm btn-primary" Size=ButtonSize.ExtraSmall Visible=true Click="@(() => AddProduct(list!.Id))" Icon="add"></RadzenButton>
                    </div>  
                </div>  

            </div>  
        }  
    </div>  
    @if(IsLoading==true)  
    {  
        <div class="text-center">  
            <div class="spinner-border" role="status">  
                <span class="visually-hidden">Loading...</span>  
            </div>  
        </div>  
    }

    <div class="fixed-bottom">  

        <div class="d-flex justify-content-between gap-2">  
            <button class="btn btn-secondary w-25" data-bs-toggle="modal" data-bs-target="#exampleModal" @onclick="GetViewOrder">Ordering @orderDetails.Count()</button>
            <button class="btn btn-primary w-75" @onclick="PlaceOrderAsync">Place Order</button>
        </div>  
    </div>  
</div> 
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Order lists</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">QTY</th>
                            <th scope="col">Price</th>
                            <th scope="col">Total Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in orderDetails)
                        {
                            <tr>
                                <td>@item.ItemName</td>
                                <td class="text-end">@item.Quantity</td>
                                <td class="text-end">@item.Price?.ToString("c2")</td>
                                <td class="text-end">@item.TotalPrice?.ToString("c2")</td>
                            </tr>
                        }
                        
                    </tbody>
                    <tbody>
                        <tr class="table-active">
                            <th></th>
                            <th class="text-end">@orderDetails.Sum(x => x.Quantity)</th>
                            <th></th>
                            <th class="text-end text-danger">@orderDetails.Sum(x => x.TotalPrice)?.ToString("c2")</th>
                        </tr>
                        <tr class="table-active">
                            <th></th>
                            <th></th>
                            <th></th>
                            <th class="text-end text-danger">@String.Format("R {0:N2}", @orderDetails.Sum(x => x.TotalPrice) * 4050)</th>
                        </tr>
                    </tbody>
               </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
               
            </div>
        </div>
    </div>
</div>